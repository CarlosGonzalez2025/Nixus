{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert } from 'firebase-admin/app';\nimport { getFirestore } from 'firebase-admin/firestore';\n\nconst apps = getApps();\n\nif (!apps.length) {\n  try {\n    const projectId = process.env.FIREBASE_PROJECT_ID;\n    const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY;\n\n    if (!projectId || !clientEmail || !privateKey) {\n      throw new Error('Missing Firebase Admin credentials in environment variables');\n    }\n\n    // Reemplazar los literales \\n con saltos de línea reales\n    const formattedPrivateKey = privateKey.replace(/\\\\n/g, '\\n');\n\n    initializeApp({\n      credential: cert({\n        projectId,\n        clientEmail,\n        privateKey: formattedPrivateKey,\n      }),\n    });\n\n    console.log('✅ Firebase Admin initialized successfully');\n  } catch (error) {\n    console.error('❌ Error initializing Firebase Admin:', error);\n    throw error;\n  }\n}\n\nexport const adminDb = getFirestore();"],"names":[],"mappings":";;;AAAA;AACA;;;;;;;;AAEA,MAAM,OAAO,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD;AAEnB,IAAI,CAAC,KAAK,MAAM,EAAE;IAChB,IAAI;QACF,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;QACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;QAEnD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,YAAY;YAC7C,MAAM,IAAI,MAAM;QAClB;QAEA,yDAAyD;QACzD,MAAM,sBAAsB,WAAW,OAAO,CAAC,QAAQ;QAEvD,CAAA,GAAA,gJAAA,CAAA,gBAAa,AAAD,EAAE;YACZ,YAAY,CAAA,GAAA,gJAAA,CAAA,OAAI,AAAD,EAAE;gBACf;gBACA;gBACA,YAAY;YACd;QACF;QAEA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,MAAM;IACR;AACF;AAEO,MAAM,UAAU,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/create/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { adminDb } from '@/lib/firebase-admin';\nimport { revalidatePath } from 'next/cache';\nimport type { Permit } from '@/types';\nimport { FieldValue } from 'firebase-admin/firestore';\n\ntype PermitCreateData = Omit<Permit, 'id' | 'createdAt' | 'status' | 'createdBy' | 'number' | 'user'> & {\n  userId: string;\n  userDisplayName: string | null;\n  userEmail: string | null;\n  userPhotoURL: string | null;\n};\n\nexport async function createPermit(data: PermitCreateData) {\n  if (!data.userId) {\n    return { success: false, error: 'User not authenticated' };\n  }\n\n  const { userId, userDisplayName, userEmail, userPhotoURL, ...permitData } = data;\n\n  // Initialize all approval roles as pending\n  const initialApprovals = {\n    solicitante: { status: 'pendiente' as const },\n    autorizante: { status: 'pendiente' as const },\n    mantenimiento: { status: 'pendiente' as const },\n    sst: { status: 'pendiente' as const }\n  };\n\n  const permitPayload: Partial<Permit> = {\n    ...permitData,\n    workType: permitData.workType && permitData.workType.length > 0 ? permitData.workType : ['general'],\n    status: 'pendiente_revision' as const,\n    createdBy: userId,\n    createdAt: FieldValue.serverTimestamp(), // ✅ Usar serverTimestamp del Admin SDK\n    user: {\n      displayName: userDisplayName,\n      email: userEmail,\n      photoURL: userPhotoURL,\n    },\n    approvals: initialApprovals,\n    closure: {},\n  };\n  \n  if (permitData.anexoAltura) {\n    permitPayload.anexoAltura = permitData.anexoAltura;\n  }\n  \n  if (permitData.anexoConfinado) {\n    permitPayload.anexoConfinado = permitData.anexoConfinado;\n  }\n\n  if (permitData.anexoIzaje) {\n    permitPayload.anexoIzaje = permitData.anexoIzaje;\n  }\n\n  if (permitData.anexoEnergias) {\n    permitPayload.anexoEnergias = permitData.anexoEnergias;\n  }\n\n\n  try {\n    // Add document to Firestore using Admin SDK\n    const docRef = await adminDb.collection('permits').add(permitPayload as any);\n    \n    // Generate and update permit number\n    const permitNumber = `PT-${Date.now()}-${docRef.id.substring(0, 6).toUpperCase()}`;\n    await docRef.update({ number: permitNumber });\n    \n    console.log('✅ Permit created successfully:', docRef.id);\n    \n    // Revalidate paths to show the new permit in the lists\n    revalidatePath('/permits');\n    revalidatePath('/dashboard');\n    \n    return { success: true, permitId: docRef.id, permitNumber };\n  } catch (error: any) {\n    console.error(\"❌ Error creating permit:\", error);\n    // Return a structured error for the client\n    return { \n      success: false, \n      error: error.message || 'Could not create permit. Please try again.' \n    };\n  }\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;AAEA;;;;;;;;;;;;AASO,eAAe,aAAa,IAAsB;IACvD,IAAI,CAAC,KAAK,MAAM,EAAE;QAChB,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyB;IAC3D;IAEA,MAAM,EAAE,MAAM,EAAE,eAAe,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG,YAAY,GAAG;IAE5E,2CAA2C;IAC3C,MAAM,mBAAmB;QACvB,aAAa;YAAE,QAAQ;QAAqB;QAC5C,aAAa;YAAE,QAAQ;QAAqB;QAC5C,eAAe;YAAE,QAAQ;QAAqB;QAC9C,KAAK;YAAE,QAAQ;QAAqB;IACtC;IAEA,MAAM,gBAAiC;QACrC,GAAG,UAAU;QACb,UAAU,WAAW,QAAQ,IAAI,WAAW,QAAQ,CAAC,MAAM,GAAG,IAAI,WAAW,QAAQ,GAAG;YAAC;SAAU;QACnG,QAAQ;QACR,WAAW;QACX,WAAW,4JAAA,CAAA,aAAU,CAAC,eAAe;QACrC,MAAM;YACJ,aAAa;YACb,OAAO;YACP,UAAU;QACZ;QACA,WAAW;QACX,SAAS,CAAC;IACZ;IAEA,IAAI,WAAW,WAAW,EAAE;QAC1B,cAAc,WAAW,GAAG,WAAW,WAAW;IACpD;IAEA,IAAI,WAAW,cAAc,EAAE;QAC7B,cAAc,cAAc,GAAG,WAAW,cAAc;IAC1D;IAEA,IAAI,WAAW,UAAU,EAAE;QACzB,cAAc,UAAU,GAAG,WAAW,UAAU;IAClD;IAEA,IAAI,WAAW,aAAa,EAAE;QAC5B,cAAc,aAAa,GAAG,WAAW,aAAa;IACxD;IAGA,IAAI;QACF,4CAA4C;QAC5C,MAAM,SAAS,MAAM,+HAAA,CAAA,UAAO,CAAC,UAAU,CAAC,WAAW,GAAG,CAAC;QAEvD,oCAAoC;QACpC,MAAM,eAAe,CAAC,GAAG,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO,EAAE,CAAC,SAAS,CAAC,GAAG,GAAG,WAAW,IAAI;QAClF,MAAM,OAAO,MAAM,CAAC;YAAE,QAAQ;QAAa;QAE3C,QAAQ,GAAG,CAAC,kCAAkC,OAAO,EAAE;QAEvD,uDAAuD;QACvD,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE;QACf,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE;QAEf,OAAO;YAAE,SAAS;YAAM,UAAU,OAAO,EAAE;YAAE;QAAa;IAC5D,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,2CAA2C;QAC3C,OAAO;YACL,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B;IACF;AACF;;;IAtEsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["import {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/google-genai';\n\nexport const ai = genkit({\n  plugins: [googleAI()],\n  model: 'googleai/gemini-2.5-flash',\n});\n"],"names":[],"mappings":";;;AAAA;AAAA;AACA;AAAA;;;AAEO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QAAC,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD;KAAI;IACrB,OAAO;AACT","debugId":null}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/risk-assessment-recommendation.ts"],"sourcesContent":["'use server';\n\n/**\n * @fileOverview Un agente de IA de evaluación de riesgos que recomienda controles de riesgo.\n *\n * - getRiskAssessmentRecommendations - Una función que gestiona el proceso de evaluación de riesgos.\n * - RiskAssessmentInput - El tipo de entrada para la función getRiskAssessmentRecommendations.\n * - RiskAssessmentOutput - El tipo de retorno para la función getRiskAssessmentRecommendations.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst RiskAssessmentInputSchema = z.object({\n  workType: z.string().describe('El tipo de trabajo que se está realizando.'),\n  environmentalFactors: z.string().describe('Factores ambientales presentes en el lugar de trabajo.'),\n  permitDetails: z.string().describe('Información detallada sobre la solicitud de permiso de trabajo.'),\n});\nexport type RiskAssessmentInput = z.infer<typeof RiskAssessmentInputSchema>;\n\nconst RiskAssessmentOutputSchema = z.object({\n  recommendedControls: z.string().describe('Los controles de riesgo recomendados para la solicitud de permiso de trabajo.'),\n});\nexport type RiskAssessmentOutput = z.infer<typeof RiskAssessmentOutputSchema>;\n\nexport async function getRiskAssessmentRecommendations(input: RiskAssessmentInput): Promise<RiskAssessmentOutput> {\n  return riskAssessmentFlow(input);\n}\n\nconst prompt = ai.definePrompt({\n  name: 'riskAssessmentPrompt',\n  input: {schema: RiskAssessmentInputSchema},\n  output: {schema: RiskAssessmentOutputSchema},\n  prompt: `Eres un oficial de seguridad responsable de evaluar riesgos y recomendar controles para permisos de trabajo.\n\n  Basándote en los detalles de la solicitud del permiso de trabajo, el tipo de trabajo que se realiza y los factores ambientales presentes, recomendarás los controles de riesgo apropiados.\n\n  Tipo de Trabajo: {{{workType}}}\n  Factores Ambientales: {{{environmentalFactors}}}\n  Detalles del Permiso: {{{permitDetails}}}\n\n  Controles de Riesgo Recomendados:`,\n});\n\nconst riskAssessmentFlow = ai.defineFlow(\n  {\n    name: 'riskAssessmentFlow',\n    inputSchema: RiskAssessmentInputSchema,\n    outputSchema: RiskAssessmentOutputSchema,\n  },\n  async input => {\n    const {output} = await prompt(input);\n    return output!;\n  }\n);\n"],"names":[],"mappings":";;;;;AAEA;;;;;;CAMC,GAED;AACA;AAAA;;;;;;AAEA,MAAM,4BAA4B,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACzC,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,sBAAsB,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1C,eAAe,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AACrC;AAGA,MAAM,6BAA6B,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC1C,qBAAqB,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AAC3C;AAGO,eAAe,iCAAiC,KAA0B;IAC/E,OAAO,mBAAmB;AAC5B;AAEA,MAAM,SAAS,mHAAA,CAAA,KAAE,CAAC,YAAY,CAAC;IAC7B,MAAM;IACN,OAAO;QAAC,QAAQ;IAAyB;IACzC,QAAQ;QAAC,QAAQ;IAA0B;IAC3C,QAAQ,CAAC;;;;;;;;mCAQwB,CAAC;AACpC;AAEA,MAAM,qBAAqB,mHAAA,CAAA,KAAE,CAAC,UAAU,CACtC;IACE,MAAM;IACN,aAAa;IACb,cAAc;AAChB,GACA,OAAM;IACJ,MAAM,EAAC,MAAM,EAAC,GAAG,MAAM,OAAO;IAC9B,OAAO;AACT;;;IA5BoB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/permits/create/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createPermit as '4097d45d85355825b31a4c927dbcb1c60fd2c554af'} from 'ACTIONS_MODULE0'\nexport {getRiskAssessmentRecommendations as '401d2929af3bb2809a59f1fa2b833eaa16ed136c97'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA","debugId":null}},
    {"offset": {"line": 618, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/create/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/create/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/create/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA","debugId":null}},
    {"offset": {"line": 632, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/create/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/create/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/create/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAqR,GAClT,mDACA","debugId":null}},
    {"offset": {"line": 646, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}