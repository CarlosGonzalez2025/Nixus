{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert } from 'firebase-admin/app';\nimport { getFirestore } from 'firebase-admin/firestore';\n\nconst apps = getApps();\n\nif (!apps.length) {\n  try {\n    const projectId = process.env.FIREBASE_PROJECT_ID;\n    const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY;\n\n    if (!projectId || !clientEmail || !privateKey) {\n      throw new Error('Missing Firebase Admin credentials in environment variables.');\n    }\n\n    // Reemplazar los literales \\n con saltos de l√≠nea reales\n    const formattedPrivateKey = privateKey.replace(/\\\\n/g, '\\n');\n\n    initializeApp({\n      credential: cert({\n        projectId,\n        clientEmail,\n        privateKey: formattedPrivateKey,\n      }),\n    });\n\n    console.log('‚úÖ Firebase Admin initialized successfully');\n  } catch (error) {\n    console.error('‚ùå Error initializing Firebase Admin:', error);\n    // Don't throw in production, just log\n    if (process.env.NODE_ENV !== 'production') {\n        throw error;\n    }\n  }\n}\n\nexport const adminDb = getFirestore();\n"],"names":[],"mappings":";;;AAAA;AACA;;;;;;;;AAEA,MAAM,OAAO,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD;AAEnB,IAAI,CAAC,KAAK,MAAM,EAAE;IAChB,IAAI;QACF,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;QACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;QAEnD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,YAAY;YAC7C,MAAM,IAAI,MAAM;QAClB;QAEA,yDAAyD;QACzD,MAAM,sBAAsB,WAAW,OAAO,CAAC,QAAQ;QAEvD,CAAA,GAAA,gJAAA,CAAA,gBAAa,AAAD,EAAE;YACZ,YAAY,CAAA,GAAA,gJAAA,CAAA,OAAI,AAAD,EAAE;gBACf;gBACA;gBACA,YAAY;YACd;QACF;QAEA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,sCAAsC;QACtC,IAAI,oDAAyB,cAAc;YACvC,MAAM;QACV;IACF;AACF;AAEO,MAAM,UAAU,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/notifications.ts"],"sourcesContent":["\n'use server';\n\nimport twilio from 'twilio';\n\n// Load credentials directly from environment variables\nconst accountSid = process.env.TWILIO_ACCOUNT_SID;\nconst authToken = process.env.TWILIO_AUTH_TOKEN;\nconst twilioWhatsAppFrom = process.env.TWILIO_WHATSAPP_FROM;\nconst whatsAppTo = process.env.WHATSAPP_TO;\n\nexport async function sendWhatsAppNotification(messageBody: string) {\n  if (!accountSid || !authToken || !twilioWhatsAppFrom || !whatsAppTo) {\n    console.error('‚ö†Ô∏è [Twilio] Error: Credenciales no configuradas. Las variables de entorno (TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_WHATSAPP_FROM, WHATSAPP_TO) deben estar definidas.');\n    // No lanzar error para no detener el flujo principal, solo registrar.\n    return { success: false, error: 'Servicio de notificaciones no configurado en el servidor.' };\n  }\n\n  const client = twilio(accountSid, authToken);\n\n  try {\n    console.log(`[Twilio] Intentando enviar notificaci√≥n a ${whatsAppTo}...`);\n    const message = await client.messages.create({\n      body: messageBody,\n      from: twilioWhatsAppFrom,\n      to: whatsAppTo,\n    });\n    console.log(`‚úÖ [Twilio] Notificaci√≥n enviada con √©xito. SID: ${message.sid}`);\n    return { success: true, sid: message.sid };\n  } catch (error) {\n    console.error('‚ùå [Twilio] Fall√≥ el env√≠o de la notificaci√≥n por WhatsApp:', error);\n    // No relanzar el error para no afectar la experiencia de usuario.\n    // El error ya est√° registrado en el servidor para depuraci√≥n.\n    return { success: false, error: 'No se pudo enviar la notificaci√≥n por WhatsApp.' };\n  }\n}\n"],"names":[],"mappings":";;;;;AAGA;;;;;AAEA,uDAAuD;AACvD,MAAM,aAAa,QAAQ,GAAG,CAAC,kBAAkB;AACjD,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;AAC/C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,oBAAoB;AAC3D,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW;AAEnC,eAAe,yBAAyB,WAAmB;IAChE,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,sBAAsB,CAAC,YAAY;QACnE,QAAQ,KAAK,CAAC;QACd,sEAAsE;QACtE,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4D;IAC9F;IAEA,MAAM,SAAS,CAAA,GAAA,sIAAA,CAAA,UAAM,AAAD,EAAE,YAAY;IAElC,IAAI;QACF,QAAQ,GAAG,CAAC,CAAC,0CAA0C,EAAE,WAAW,GAAG,CAAC;QACxE,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,MAAM,CAAC;YAC3C,MAAM;YACN,MAAM;YACN,IAAI;QACN;QACA,QAAQ,GAAG,CAAC,CAAC,gDAAgD,EAAE,QAAQ,GAAG,EAAE;QAC5E,OAAO;YAAE,SAAS;YAAM,KAAK,QAAQ,GAAG;QAAC;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8DAA8D;QAC5E,kEAAkE;QAClE,8DAA8D;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAkD;IACpF;AACF;;;IAxBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/actions.ts"],"sourcesContent":["'use server';\n\nimport { adminDb } from '@/lib/firebase-admin';\nimport { revalidatePath } from 'next/cache';\nimport type { Permit, ExternalWorker, PermitStatus, PermitClosure, Approval, UserRole } from '@/types';\nimport { FieldValue } from 'firebase-admin/firestore';\nimport { sendWhatsAppNotification } from '@/lib/notifications';\nimport { config } from 'dotenv';\nconfig();\n\n// Mapeo actualizado de tipos de trabajo seg√∫n documentaci√≥n\nconst workTypesMap: {[key: string]: string} = {\n  'trabajoAlturas': 'Trabajo en Alturas',\n  'espaciosConfinados': 'Espacios Confinados',\n  'controlEnergia': 'Control de Energ√≠as',\n  'izajeCargas': 'Izaje de Cargas',\n  'trabajoCaliente': 'Trabajo en Caliente',\n  'excavaciones': 'Excavaciones',\n  'trabajoGeneral': 'Trabajo General',\n  // Mantener compatibilidad con nomenclatura anterior\n  'altura': 'Trabajo en Alturas',\n  'confinado': 'Espacios Confinados',\n  'energia': 'Control de Energ√≠as',\n  'izaje': 'Izaje de Cargas',\n  'caliente': 'Trabajo en Caliente',\n  'excavacion': 'Excavaciones',\n  'general': 'Trabajo General'\n};\n\nconst getWorkTypesString = (permit: any): string => {\n  // Priorizar los nuevos campos booleanos\n  const workTypes: string[] = [];\n  \n  if (permit.trabajoAlturas) workTypes.push('Trabajo en Alturas');\n  if (permit.espaciosConfinados) workTypes.push('Espacios Confinados');\n  if (permit.controlEnergia) workTypes.push('Control de Energ√≠as');\n  if (permit.izajeCargas) workTypes.push('Izaje de Cargas');\n  if (permit.trabajoCaliente) workTypes.push('Trabajo en Caliente');\n  if (permit.excavaciones) workTypes.push('Excavaciones');\n  if (permit.trabajoGeneral) workTypes.push('Trabajo General');\n  \n  // Fallback al campo workType si existe (compatibilidad)\n  if (workTypes.length === 0 && permit.workType && Array.isArray(permit.workType)) {\n    return permit.workType.map((key: string) => workTypesMap[key] || key).join(', ');\n  }\n  \n  return workTypes.length > 0 ? workTypes.join(', ') : 'Trabajo General';\n};\n\nconst getStatusText = (status: string) => {\n  const statusText: {[key: string]: string} = {\n    'borrador': 'Borrador',\n    'pendiente_revision': 'Pendiente de Revisi√≥n',\n    'aprobado': 'Aprobado',\n    'en_ejecucion': 'En Ejecuci√≥n',\n    'suspendido': 'Suspendido',\n    'cerrado': 'Cerrado',\n    'rechazado': 'Rechazado'\n  };\n  return statusText[status] || status;\n};\n\nconst signatureRoles: { [key in UserRole | 'sst' | 'mantenimiento']: string } = {\n  solicitante: 'QUIEN SOLICITA (JEFES Y DUE√ëOS DE AREA)',\n  autorizante: 'QUIEN AUTORIZA (L√çDER A CARGO DEL EQUIPO EJECUTANTE)',\n  mantenimiento: 'PERSONAL DE MANTENIMIENTO',\n  sst: 'AREA SST (si aplica)',\n  lider_tarea: 'L√≠der de la Tarea',\n  ejecutante: 'Ejecutante del Trabajo',\n  lider_sst: 'L√≠der SST',\n  admin: 'Administrador'\n};\n\ntype PermitCreateData = Omit<Permit, 'id' | 'createdAt' | 'status' | 'createdBy' | 'number' | 'user'> & {\n  userId: string;\n  userDisplayName: string | null;\n  userEmail: string | null;\n  userPhotoURL: string | null;\n};\n\nexport async function createPermit(data: PermitCreateData) {\n  if (!data.userId) {\n    return { success: false, error: 'User not authenticated' };\n  }\n\n  const { userId, userDisplayName, userEmail, userPhotoURL, ...permitData } = data;\n\n  const initialApprovals = {\n    solicitante: { status: 'pendiente' as const },\n    autorizante: { status: 'pendiente' as const },\n    mantenimiento: { status: 'pendiente' as const },\n    sst: { status: 'pendiente' as const }\n  };\n\n  // Preparar el payload del permiso con la nueva estructura\n  const permitPayload: Partial<Permit> = {\n    ...permitData,\n    status: 'pendiente_revision' as const,\n    createdBy: userId,\n    createdAt: FieldValue.serverTimestamp(),\n    fechaCreacion: FieldValue.serverTimestamp(),\n    user: {\n      displayName: userDisplayName,\n      email: userEmail,\n      photoURL: userPhotoURL,\n    },\n    approvals: initialApprovals,\n    closure: {},\n  };\n\n  // Convertir fechas a Timestamp si existen\n  if (permitData.fechaInicio) {\n    permitPayload.fechaInicio = FieldValue.serverTimestamp();\n  }\n  if (permitData.fechaFin) {\n    permitPayload.fechaFin = FieldValue.serverTimestamp();\n  }\n\n  // Solo incluir anexos si los tipos de trabajo correspondientes est√°n seleccionados\n  if (permitData.trabajoAlturas && permitData.anexoAlturas) {\n    permitPayload.anexoAlturas = permitData.anexoAlturas;\n  }\n  \n  if (permitData.espaciosConfinados && permitData.anexoConfinado) {\n    permitPayload.anexoConfinado = permitData.anexoConfinado;\n  }\n  \n  if (permitData.controlEnergia && permitData.anexoEnergias) {\n    permitPayload.anexoEnergias = permitData.anexoEnergias;\n  }\n  \n  if (permitData.izajeCargas && permitData.anexoIzaje) {\n    permitPayload.anexoIzaje = permitData.anexoIzaje;\n  }\n  \n  if (permitData.excavaciones && permitData.anexoExcavaciones) {\n    permitPayload.anexoExcavaciones = permitData.anexoExcavaciones;\n  }\n\n  // Mantener compatibilidad con anexoATS si existe\n  if (permitData.anexoATS) {\n    permitPayload.anexoATS = permitData.anexoATS;\n  }\n\n  // Mantener compatibilidad con workType para sistemas legacy\n  if (permitData.workType && permitData.workType.length > 0) {\n    permitPayload.workType = permitData.workType;\n  }\n\n  try {\n    const docRef = await adminDb.collection('permits').add(permitPayload as any);\n    const permitNumber = `PT-${Date.now()}-${docRef.id.substring(0, 6).toUpperCase()}`;\n    await docRef.update({ \n      number: permitNumber,\n      numeroPermiso: permitNumber \n    });\n    \n    console.log('‚úÖ [Action] Permiso creado con √©xito en Firestore:', docRef.id);\n\n    // Obtener tipos de trabajo para la notificaci√≥n\n    const workTypesText = getWorkTypesString(permitPayload);\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n    const permitUrl = `${baseUrl}/permits/${docRef.id}`;\n    \n    const messageBody = `*¬°Alerta de Seguridad SGPT!* üö®\nSe ha creado una nueva solicitud de permiso de trabajo.\n\nüìÑ *N√∫mero:* ${permitNumber}\nüë§ *Solicitante:* ${userDisplayName || 'N/A'}\nüìç *√Årea:* ${permitData.areaEspecifica || 'N/A'}\nüè≠ *Planta:* ${permitData.planta || 'N/A'}\nüõ†Ô∏è *Tipo de Trabajo:* ${workTypesText}\nüìù *Descripci√≥n:* ${permitData.descripcionTarea?.substring(0, 100) || 'N/A'}${permitData.descripcionTarea && permitData.descripcionTarea.length > 100 ? '...' : ''}\n\nPor favor, revise la solicitud para su aprobaci√≥n en el siguiente enlace:\n${permitUrl}`;\n    \n    await sendWhatsAppNotification(messageBody);\n    \n    revalidatePath('/permits');\n    revalidatePath('/dashboard');\n    \n    return { success: true, permitId: docRef.id, permitNumber };\n  } catch (error: any) {\n    console.error(\"‚ùå [Action] Error al crear permiso:\", error);\n    return { \n      success: false, \n      error: error.message || 'Could not create permit. Please try again.' \n    };\n  }\n}\n\nexport async function addSignatureAndNotify(\n  permitId: string, \n  role: 'solicitante' | 'autorizante' | 'mantenimiento' | 'sst', \n  signatureType: 'firmaApertura' | 'firmaCierre',\n  signatureDataUrl: string,\n  user: { uid: string, displayName: string | null }\n) {\n  if (!permitId || !role || !signatureDataUrl || !user) {\n    return { success: false, error: 'Faltan par√°metros para guardar la firma.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    \n    const signaturePath = `approvals.${role}.${signatureType}`;\n    const statusPath = `approvals.${role}.status`;\n    const userIdPath = `approvals.${role}.userId`;\n    const userNamePath = `approvals.${role}.userName`;\n    const signedAtPath = `approvals.${role}.signedAt`;\n\n    const updateData: { [key: string]: any } = {\n      [signaturePath]: signatureDataUrl,\n      [`${userNamePath}`]: user.displayName,\n      [`${userIdPath}`]: user.uid,\n    };\n\n    if (signatureType === 'firmaApertura') {\n      updateData[statusPath] = 'aprobado';\n      updateData[signedAtPath] = FieldValue.serverTimestamp();\n    }\n\n    await docRef.update(updateData);\n    \n    // Fetch permit for notification\n    const permitDoc = await docRef.get();\n    const permitData = permitDoc.data() as Permit;\n    \n    const signatureRoleName = (signatureRoles as any)[role] || role;\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n    const permitUrl = `${baseUrl}/permits/${permitId}`;\n    \n    const workTypesText = getWorkTypesString(permitData);\n    \n    const messageBody = `*Notificaci√≥n de Firma - SGPT* üñãÔ∏è\nEl permiso *${permitData.number || permitData.numeroPermiso || permitId}* ha sido firmado.\n\nüë§ *Qui√©n firm√≥:* ${user.displayName || 'N/A'}\n‚ú® *Rol:* ${signatureRoleName}\n‚úçÔ∏è *Tipo de firma:* ${signatureType === 'firmaApertura' ? 'Apertura' : 'Cierre'}\nüìç *√Årea:* ${permitData.areaEspecifica || 'N/A'}\nüõ†Ô∏è *Tipo de Trabajo:* ${workTypesText}\n\nPuede ver los detalles aqu√≠:\n${permitUrl}`;\n    \n    await sendWhatsAppNotification(messageBody);\n\n    revalidatePath(`/permits/${permitId}`);\n    return { success: true };\n\n  } catch (error: any) {\n    console.error(\"‚ùå Error al guardar firma y notificar:\", error);\n    return {\n      success: false,\n      error: error.message || 'No se pudo guardar la firma.'\n    };\n  }\n}\n\nexport async function updatePermitStatus(\n  permitId: string, \n  status: PermitStatus, \n  reason?: string, \n  closureData?: Partial<PermitClosure>\n) {\n  if (!permitId) {\n    return { success: false, error: 'Permit ID is required.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    const updateData: { \n      status: PermitStatus; \n      rejectionReason?: string; \n      closure?: Partial<PermitClosure> | FieldValue \n    } = { status };\n\n    if (status === 'rechazado' && reason) {\n      updateData.rejectionReason = reason;\n    }\n\n    if (status === 'cerrado') {\n      updateData.closure = {\n        ...(closureData || {}),\n        fechaCierre: FieldValue.serverTimestamp(),\n      };\n    }\n\n    await docRef.update(updateData);\n\n    // Fetch permit for notification\n    const permitDoc = await docRef.get();\n    const permitData = permitDoc.data() as Permit;\n\n    const statusText = getStatusText(status);\n    const workTypesText = getWorkTypesString(permitData);\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n    const permitUrl = `${baseUrl}/permits/${permitId}`;\n\n    let messageBody = `*Actualizaci√≥n de Estado - SGPT* üîÑ\nEl estado del permiso *${permitData.number || permitData.numeroPermiso || permitId}* ha cambiado.\n\n*Nuevo Estado:* ${statusText}\nüìç *√Årea:* ${permitData.areaEspecifica || 'N/A'}\nüè≠ *Planta:* ${permitData.planta || 'N/A'}\nüõ†Ô∏è *Tipo de Trabajo:* ${workTypesText}\n\nPuede ver los detalles aqu√≠:\n${permitUrl}`;\n\n    if (status === 'rechazado' && reason) {\n      messageBody += `\\n\\n*Motivo del rechazo:* ${reason}`;\n    }\n    \n    if (status === 'cerrado' && closureData) {\n      messageBody += `\\n\\n*Informaci√≥n de cierre:*`;\n      if (closureData.areaDespejada) {\n        messageBody += `\\n‚Ä¢ √Årea despejada: ${closureData.areaDespejada}`;\n      }\n      if (closureData.informoResponsable) {\n        messageBody += `\\n‚Ä¢ Inform√≥ al responsable: ${closureData.informoResponsable}`;\n      }\n    }\n    \n    await sendWhatsAppNotification(messageBody);\n    \n    revalidatePath(`/permits/${permitId}`);\n    revalidatePath('/permits');\n    revalidatePath('/dashboard');\n\n    return { success: true };\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating permit status:\", error);\n    return {\n      success: false,\n      error: error.message || 'Could not update permit status.'\n    };\n  }\n}\n\n// Nueva funci√≥n para actualizar campos espec√≠ficos del permiso\nexport async function updatePermitData(\n  permitId: string,\n  updateData: Partial<Permit>\n) {\n  if (!permitId) {\n    return { success: false, error: 'Permit ID is required.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    \n    // Limpiar datos undefined\n    const cleanData = Object.fromEntries(\n      Object.entries(updateData).filter(([_, v]) => v !== undefined)\n    );\n\n    await docRef.update(cleanData);\n    \n    revalidatePath(`/permits/${permitId}`);\n    revalidatePath('/permits');\n    \n    return { success: true };\n  } catch (error: any) {\n    console.error(\"‚ùå Error updating permit data:\", error);\n    return {\n      success: false,\n      error: error.message || 'Could not update permit data.'\n    };\n  }\n}\n\n// Nueva funci√≥n para validaci√≥n diaria\nexport async function addDailyValidation(\n  permitId: string,\n  anexoType: 'anexoAlturas' | 'anexoConfinado' | 'anexoExcavaciones',\n  validationType: 'autoridad' | 'responsable',\n  validationData: {\n    dia: number;\n    fecha: string;\n    nombre: string;\n    firma: string;\n  }\n) {\n  if (!permitId || !anexoType || !validationType) {\n    return { success: false, error: 'Faltan par√°metros requeridos.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    const permitDoc = await docRef.get();\n    const permitData = permitDoc.data() as Permit;\n\n    if (!permitData[anexoType]) {\n      return { success: false, error: `El anexo ${anexoType} no existe en este permiso.` };\n    }\n\n    const anexo = permitData[anexoType] as any;\n    \n    if (!anexo.validacionDiaria) {\n      anexo.validacionDiaria = [];\n    }\n\n    // Agregar la validaci√≥n\n    anexo.validacionDiaria.push(validationData);\n\n    await docRef.update({\n      [anexoType]: anexo\n    });\n\n    revalidatePath(`/permits/${permitId}`);\n    \n    return { success: true };\n  } catch (error: any) {\n    console.error(\"‚ùå Error adding daily validation:\", error);\n    return {\n      success: false,\n      error: error.message || 'No se pudo agregar la validaci√≥n diaria.'\n    };\n  }\n}\n\n// Nueva funci√≥n para agregar trabajadores\nexport async function addWorkerToPermit(\n  permitId: string,\n  worker: ExternalWorker\n) {\n  if (!permitId || !worker) {\n    return { success: false, error: 'Faltan par√°metros requeridos.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    \n    await docRef.update({\n      workers: FieldValue.arrayUnion(worker)\n    });\n\n    revalidatePath(`/permits/${permitId}`);\n    \n    return { success: true };\n  } catch (error: any) {\n    console.error(\"‚ùå Error adding worker:\", error);\n    return {\n      success: false,\n      error: error.message || 'No se pudo agregar el trabajador.'\n    };\n  }\n}\n\n// Nueva funci√≥n para eliminar trabajadores\nexport async function removeWorkerFromPermit(\n  permitId: string,\n  workerCedula: string\n) {\n  if (!permitId || !workerCedula) {\n    return { success: false, error: 'Faltan par√°metros requeridos.' };\n  }\n\n  try {\n    const docRef = adminDb.collection('permits').doc(permitId);\n    const permitDoc = await docRef.get();\n    const permitData = permitDoc.data() as Permit;\n\n    if (!permitData.workers) {\n      return { success: false, error: 'No hay trabajadores en este permiso.' };\n    }\n\n    const updatedWorkers = permitData.workers.filter(\n      (w: ExternalWorker) => w.cedula !== workerCedula\n    );\n\n    await docRef.update({\n      workers: updatedWorkers\n    });\n\n    revalidatePath(`/permits/${permitId}`);\n    \n    return { success: true };\n  } catch (error: any) {\n    console.error(\"‚ùå Error removing worker:\", error);\n    return {\n      success: false,\n      error: error.message || 'No se pudo eliminar el trabajador.'\n    };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 711, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/permits/create/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createPermit as '401402f01c0118016efe5c5d736d335e2f6d150079'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 792, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/create/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/create/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/create/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA","debugId":null}},
    {"offset": {"line": 806, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/create/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/create/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/create/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAqR,GAClT,mDACA","debugId":null}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}