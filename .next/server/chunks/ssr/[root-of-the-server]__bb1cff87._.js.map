{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["\nimport { initializeApp, getApps, cert, App } from 'firebase-admin/app';\nimport { getFirestore } from 'firebase-admin/firestore';\n\nlet adminApp: App | undefined;\nlet adminFirestoreDb: ReturnType<typeof getFirestore> | undefined;\n\nfunction initializeAdminApp() {\n  const apps = getApps();\n  if (apps.length > 0) {\n    adminApp = apps[0];\n    adminFirestoreDb = getFirestore(adminApp);\n    return;\n  }\n\n  try {\n    const projectId = process.env.FIREBASE_PROJECT_ID;\n    const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY;\n\n    if (projectId && clientEmail && privateKey && privateKey !== 'YOUR_PRIVATE_KEY' && clientEmail !== 'YOUR_CLIENT_EMAIL') {\n      const formattedPrivateKey = privateKey.replace(/\\\\n/g, '\\n');\n      adminApp = initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail,\n          privateKey: formattedPrivateKey,\n        }),\n      });\n      adminFirestoreDb = getFirestore(adminApp);\n      console.log('✅ Firebase Admin SDK inicializado correctamente.');\n    } else {\n      console.warn('⚠️ [Firebase Admin] Credenciales de administrador no configuradas en .env. Las funciones de servidor (Server Actions) que requieren acceso de administrador no funcionarán.');\n    }\n  } catch (error: any) {\n    console.error('❌ Error al inicializar Firebase Admin SDK:', error.message);\n  }\n}\n\ninitializeAdminApp();\n\n// Función para verificar si el SDK de Admin está listo\nexport const isAdminReady = () => !!adminApp;\n\n// Exportamos la instancia de la base de datos de manera segura\n// Si no está inicializada, las funciones que la usen fallarán con el nuevo chequeo.\nexport const adminDb = adminFirestoreDb!;\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACP,MAAM,OAAO,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD;IACnB,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,WAAW,IAAI,CAAC,EAAE;QAClB,mBAAmB,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD,EAAE;QAChC;IACF;IAEA,IAAI;QACF,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;QACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;QAEnD,IAAI,aAAa,eAAe,cAAc,eAAe,sBAAsB,gBAAgB,qBAAqB;YACtH,MAAM,sBAAsB,WAAW,OAAO,CAAC,QAAQ;YACvD,WAAW,CAAA,GAAA,gJAAA,CAAA,gBAAa,AAAD,EAAE;gBACvB,YAAY,CAAA,GAAA,gJAAA,CAAA,OAAI,AAAD,EAAE;oBACf;oBACA;oBACA,YAAY;gBACd;YACF;YACA,mBAAmB,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD,EAAE;YAChC,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,IAAI,CAAC;QACf;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8CAA8C,MAAM,OAAO;IAC3E;AACF;AAEA;AAGO,MAAM,eAAe,IAAM,CAAC,CAAC;AAI7B,MAAM,UAAU","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { getAuth } from 'firebase-admin/auth';\nimport { adminDb } from '@/lib/firebase-admin';\nimport * as z from 'zod';\nimport type { User, UserRole } from '@/types';\n\nconst createFormSchema = z.object({\n  fullName: z.string().min(3),\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['solicitante', 'autorizante', 'lider_tarea', 'ejecutante', 'lider_sst', 'admin', 'mantenimiento']),\n  area: z.string().optional(),\n  telefono: z.string().optional(),\n  empresa: z.string().min(2),\n  ciudad: z.string().optional(),\n  planta: z.string().optional(),\n});\n\nconst updateFormSchema = z.object({\n  uid: z.string(),\n  displayName: z.string().min(3, { message: \"El nombre es requerido.\" }),\n  email: z.string().email({ message: \"Correo electrónico inválido.\" }),\n  role: z.enum(['solicitante', 'autorizante', 'lider_tarea', 'ejecutante', 'lider_sst', 'admin', 'mantenimiento']),\n  area: z.string().optional(),\n  telefono: z.string().optional(),\n  empresa: z.string().min(2, { message: \"La empresa es requerida.\" }),\n  ciudad: z.string().optional(),\n  planta: z.string().optional(),\n});\n\n\nexport async function createUser(data: z.infer<typeof createFormSchema>) {\n  try {\n    const auth = getAuth();\n    \n    const userRecord = await auth.createUser({\n      email: data.email,\n      password: data.password,\n      displayName: data.fullName,\n    });\n    \n    const userProfile: User = {\n      uid: userRecord.uid,\n      email: userRecord.email,\n      displayName: data.fullName,\n      role: data.role,\n      area: data.area,\n      telefono: data.telefono,\n      empresa: data.empresa,\n      ciudad: data.ciudad,\n      planta: data.planta,\n      photoURL: userRecord.photoURL || '',\n      disabled: false,\n    };\n    \n    await adminDb.collection('users').doc(userRecord.uid).set(userProfile);\n    \n    return { success: true, userId: userRecord.uid };\n\n  } catch (error: any) {\n    console.error('Error creating user with Admin SDK:', error);\n    if (error.code === 'auth/email-already-exists') {\n      return { error: 'Este correo electrónico ya está registrado. Por favor, use otro.' };\n    }\n    return { error: 'Ocurrió un error inesperado al crear el usuario.' };\n  }\n}\n\nexport async function updateUser(data: z.infer<typeof updateFormSchema>) {\n  try {\n    const auth = getAuth();\n    \n    // 1. Update Firebase Authentication\n    await auth.updateUser(data.uid, {\n        email: data.email,\n        displayName: data.displayName,\n    });\n\n    // 2. Update Firestore document\n    const { uid, ...profileData } = data;\n    await adminDb.collection('users').doc(uid).update(profileData);\n    \n    return { success: true };\n  } catch (error: any) {\n     console.error('Error updating user:', error);\n     return { error: 'No se pudo actualizar el usuario.' };\n  }\n}\n\nexport async function updateUserStatus(userId: string, disabled: boolean) {\n    try {\n        const auth = getAuth();\n        await auth.updateUser(userId, { disabled });\n        await adminDb.collection('users').doc(userId).update({ disabled });\n        return { success: true };\n    } catch (error: any) {\n        console.error('Error updating user status:', error);\n        return { error: 'No se pudo actualizar el estado del usuario.'};\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/admin/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createUser as '4059629ae2f0521e82f84b9477b9974c4724130ad2'} from 'ACTIONS_MODULE0'\nexport {updateUser as '403588106b92a35c754494dad61615c4019356ea09'} from 'ACTIONS_MODULE0'\nexport {updateUserStatus as '602d3d5afd29db73ae0a1b3cf70e2adf3f1597192f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/admin/users/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/admin/users/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","debugId":null}},
    {"offset": {"line": 351, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/admin/users/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/admin/users/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","debugId":null}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}