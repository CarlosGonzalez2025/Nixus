{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\n\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};\n\n\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n\nexport { app, auth, db, firebaseConfig };\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP;AAGA,MAAM,MAAM,CAAC,CAAA,GAAA,oLAAA,CAAA,UAAO,AAAD,IAAI,MAAM,GAAG,CAAA,GAAA,oLAAA,CAAA,gBAAa,AAAD,EAAE,kBAAkB,CAAA,GAAA,oLAAA,CAAA,SAAM,AAAD;AACrE,MAAM,OAAO,CAAA,GAAA,yOAAA,CAAA,UAAO,AAAD,EAAE;AACrB,MAAM,KAAK,CAAA,GAAA,iKAAA,CAAA,eAAY,AAAD,EAAE","debugId":null}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/error-emitter.ts"],"sourcesContent":["\nimport { EventEmitter } from 'events';\nimport type { FirestorePermissionError } from './errors';\n\n// This is a workaround for the fact that EventEmitter is not typed\ninterface TypedEventEmitter {\n  on(event: 'permission-error', listener: (error: FirestorePermissionError) => void): this;\n  emit(event: 'permission-error', error: FirestorePermissionError): boolean;\n}\n\nclass SafeEventEmitter extends EventEmitter implements TypedEventEmitter {}\n\n// Create a singleton instance of the event emitter\nexport const errorEmitter = new SafeEventEmitter();\n"],"names":[],"mappings":";;;AACA;;AASA,MAAM,yBAAyB,qGAAA,CAAA,eAAY;AAA+B;AAGnE,MAAM,eAAe,IAAI","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/errors.ts"],"sourcesContent":["\nexport type SecurityRuleContext = {\n  path: string;\n  operation: 'get' | 'list' | 'create' | 'update' | 'delete' | 'write';\n  requestResourceData?: any;\n};\n\nexport class FirestorePermissionError extends Error {\n  context: SecurityRuleContext;\n\n  constructor(context: SecurityRuleContext) {\n    const message = `FirestoreError: Missing or insufficient permissions. The following request was denied by Firestore Security Rules:\\n${JSON.stringify(\n      {\n        context,\n      },\n      null,\n      2\n    )}`;\n    super(message);\n    this.name = 'FirestorePermissionError';\n    this.context = context;\n\n    // This is to make the error message more readable in the console\n    Object.setPrototypeOf(this, FirestorePermissionError.prototype);\n  }\n}\n"],"names":[],"mappings":";;;AAOO,MAAM,iCAAiC;IAC5C,QAA6B;IAE7B,YAAY,OAA4B,CAAE;QACxC,MAAM,UAAU,CAAC,oHAAoH,EAAE,KAAK,SAAS,CACnJ;YACE;QACF,GACA,MACA,IACC;QACH,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;QAEf,iEAAiE;QACjE,OAAO,cAAc,CAAC,IAAI,EAAE,yBAAyB,SAAS;IAChE;AACF","debugId":null}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/actions.ts"],"sourcesContent":["\n'use server';\nimport { createUserWithEmailAndPassword } from 'firebase/auth';\nimport { doc, setDoc } from 'firebase/firestore';\nimport * as z from 'zod';\nimport { db, auth } from '@/lib/firebase';\nimport type { User } from '@/types';\nimport { errorEmitter } from '@/lib/error-emitter';\nimport { FirestorePermissionError, type SecurityRuleContext } from '@/lib/errors';\n\n\nconst formSchema = z.object({\n  fullName: z.string().min(3),\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['solicitante', 'autorizante', 'lider_tarea', 'ejecutante', 'lider_sst', 'admin']),\n  area: z.string().optional(),\n  telefono: z.string().optional(),\n  empresa: z.string().min(2),\n  ciudad: z.string().optional(),\n  planta: z.string().optional(),\n});\n\nexport async function createUser(data: z.infer<typeof formSchema>) {\n  try {\n    // 1. Create user in Firebase Authentication using the main auth instance\n    const userCredential = await createUserWithEmailAndPassword(auth, data.email, data.password);\n    const user = userCredential.user;\n\n    // 2. Create user profile in Firestore\n    const userProfile: User = {\n      uid: user.uid,\n      email: user.email,\n      displayName: data.fullName,\n      role: data.role,\n      area: data.area,\n      telefono: data.telefono,\n      empresa: data.empresa,\n      ciudad: data.ciudad,\n      planta: data.planta,\n      photoURL: user.photoURL || '',\n    };\n    \n    const userDocRef = doc(db, 'users', user.uid);\n\n    // Use .catch() for Firestore operation to emit a detailed error\n    setDoc(userDocRef, userProfile).catch((serverError) => {\n        const permissionError = new FirestorePermissionError({\n          path: userDocRef.path,\n          operation: 'create',\n          requestResourceData: userProfile,\n        } satisfies SecurityRuleContext);\n        \n        errorEmitter.emit('permission-error', permissionError);\n    });\n    \n    return { success: true, userId: user.uid };\n\n  } catch (error: any) {\n    console.error('Error creating auth user:', error.code, error.message);\n    if (error.code === 'auth/email-already-in-use') {\n      return { error: 'Este correo electrónico ya está registrado. Por favor, use otro.' };\n    }\n    return { error: 'Ocurrió un error inesperado al crear el usuario.' };\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;;AAGA,MAAM,aAAa,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,EAAE;IAC1B,UAAU,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC;IACzB,OAAO,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,KAAK;IACvB,UAAU,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC;IACzB,MAAM,CAAA,GAAA,oIAAA,CAAA,OAAM,AAAD,EAAE;QAAC;QAAe;QAAe;QAAe;QAAc;QAAa;KAAQ;IAC9F,MAAM,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ;IACzB,UAAU,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ;IAC7B,SAAS,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,GAAG,CAAC;IACxB,QAAQ,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ;IAC3B,QAAQ,CAAA,GAAA,oIAAA,CAAA,SAAQ,AAAD,IAAI,QAAQ;AAC7B;AAEO,eAAe,WAAW,IAAgC;IAC/D,IAAI;QACF,yEAAyE;QACzE,MAAM,iBAAiB,MAAM,CAAA,GAAA,iQAAA,CAAA,iCAA8B,AAAD,EAAE,sHAAA,CAAA,OAAI,EAAE,KAAK,KAAK,EAAE,KAAK,QAAQ;QAC3F,MAAM,OAAO,eAAe,IAAI;QAEhC,sCAAsC;QACtC,MAAM,cAAoB;YACxB,KAAK,KAAK,GAAG;YACb,OAAO,KAAK,KAAK;YACjB,aAAa,KAAK,QAAQ;YAC1B,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,UAAU,KAAK,QAAQ;YACvB,SAAS,KAAK,OAAO;YACrB,QAAQ,KAAK,MAAM;YACnB,QAAQ,KAAK,MAAM;YACnB,UAAU,KAAK,QAAQ,IAAI;QAC7B;QAEA,MAAM,aAAa,CAAA,GAAA,iKAAA,CAAA,MAAG,AAAD,EAAE,sHAAA,CAAA,KAAE,EAAE,SAAS,KAAK,GAAG;QAE5C,gEAAgE;QAChE,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,YAAY,aAAa,KAAK,CAAC,CAAC;YACnC,MAAM,kBAAkB,IAAI,oHAAA,CAAA,2BAAwB,CAAC;gBACnD,MAAM,WAAW,IAAI;gBACrB,WAAW;gBACX,qBAAqB;YACvB;YAEA,8HAAA,CAAA,eAAY,CAAC,IAAI,CAAC,oBAAoB;QAC1C;QAEA,OAAO;YAAE,SAAS;YAAM,QAAQ,KAAK,GAAG;QAAC;IAE3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,6BAA6B,MAAM,IAAI,EAAE,MAAM,OAAO;QACpE,IAAI,MAAM,IAAI,KAAK,6BAA6B;YAC9C,OAAO;gBAAE,OAAO;YAAmE;QACrF;QACA,OAAO;YAAE,OAAO;QAAmD;IACrE;AACF;;;IA1CsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/admin/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createUser as '4059629ae2f0521e82f84b9477b9974c4724130ad2'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/admin/users/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/admin/users/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","debugId":null}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/admin/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/admin/users/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/admin/users/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","debugId":null}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}