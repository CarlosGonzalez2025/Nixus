{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase-admin.ts"],"sourcesContent":["\nimport { initializeApp, getApps, cert, App } from 'firebase-admin/app';\nimport { getFirestore } from 'firebase-admin/firestore';\n\nlet adminApp: App | undefined;\nlet adminFirestoreDb: ReturnType<typeof getFirestore> | undefined;\n\nfunction initializeAdminApp() {\n  const apps = getApps();\n  if (apps.length > 0) {\n    adminApp = apps[0];\n    adminFirestoreDb = getFirestore(adminApp);\n    return;\n  }\n\n  try {\n    const projectId = process.env.FIREBASE_PROJECT_ID;\n    const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\n    const privateKey = process.env.FIREBASE_PRIVATE_KEY;\n\n    if (projectId && clientEmail && privateKey && privateKey !== 'YOUR_PRIVATE_KEY' && clientEmail !== 'YOUR_CLIENT_EMAIL') {\n      const formattedPrivateKey = privateKey.replace(/\\\\n/g, '\\n');\n      adminApp = initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail,\n          privateKey: formattedPrivateKey,\n        }),\n      });\n      adminFirestoreDb = getFirestore(adminApp);\n      console.log('‚úÖ Firebase Admin SDK inicializado correctamente.');\n    } else {\n      console.warn('‚ö†Ô∏è [Firebase Admin] Credenciales de administrador no configuradas en .env. Las funciones de servidor (Server Actions) que requieren acceso de administrador no funcionar√°n.');\n    }\n  } catch (error: any) {\n    console.error('‚ùå Error al inicializar Firebase Admin SDK:', error.message);\n  }\n}\n\ninitializeAdminApp();\n\n// Funci√≥n para verificar si el SDK de Admin est√° listo\nexport const isAdminReady = () => !!adminApp;\n\n// Exportamos la instancia de la base de datos de manera segura\n// Si no est√° inicializada, las funciones que la usen fallar√°n con el nuevo chequeo.\nexport const adminDb = adminFirestoreDb!;\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACP,MAAM,OAAO,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD;IACnB,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,WAAW,IAAI,CAAC,EAAE;QAClB,mBAAmB,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD,EAAE;QAChC;IACF;IAEA,IAAI;QACF,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;QACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;QAEnD,IAAI,aAAa,eAAe,cAAc,eAAe,sBAAsB,gBAAgB,qBAAqB;YACtH,MAAM,sBAAsB,WAAW,OAAO,CAAC,QAAQ;YACvD,WAAW,CAAA,GAAA,gJAAA,CAAA,gBAAa,AAAD,EAAE;gBACvB,YAAY,CAAA,GAAA,gJAAA,CAAA,OAAI,AAAD,EAAE;oBACf;oBACA;oBACA,YAAY;gBACd;YACF;YACA,mBAAmB,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD,EAAE;YAChC,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,IAAI,CAAC;QACf;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8CAA8C,MAAM,OAAO;IAC3E;AACF;AAEA;AAGO,MAAM,eAAe,IAAM,CAAC,CAAC;AAI7B,MAAM,UAAU","debugId":null}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/notifications.ts"],"sourcesContent":["\n'use server';\n\nimport twilio from 'twilio';\n\n// Load credentials directly from environment variables\nconst accountSid = process.env.TWILIO_ACCOUNT_SID;\nconst authToken = process.env.TWILIO_AUTH_TOKEN;\nconst twilioWhatsAppFrom = process.env.TWILIO_WHATSAPP_FROM;\nconst whatsAppTo = process.env.WHATSAPP_TO;\n\nexport async function sendWhatsAppNotification(messageBody: string) {\n  if (!accountSid || !authToken || !twilioWhatsAppFrom || !whatsAppTo) {\n    console.error('‚ö†Ô∏è [Twilio] Error: Credenciales no configuradas. Las variables de entorno (TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_WHATSAPP_FROM, WHATSAPP_TO) deben estar definidas.');\n    // No lanzar error para no detener el flujo principal, solo registrar.\n    return { success: false, error: 'Servicio de notificaciones no configurado en el servidor.' };\n  }\n\n  const client = twilio(accountSid, authToken);\n\n  try {\n    console.log(`[Twilio] Intentando enviar notificaci√≥n a ${whatsAppTo}...`);\n    const message = await client.messages.create({\n      body: messageBody,\n      from: twilioWhatsAppFrom,\n      to: whatsAppTo,\n    });\n    console.log(`‚úÖ [Twilio] Notificaci√≥n enviada con √©xito. SID: ${message.sid}`);\n    return { success: true, sid: message.sid };\n  } catch (error) {\n    console.error('‚ùå [Twilio] Fall√≥ el env√≠o de la notificaci√≥n por WhatsApp:', error);\n    // No relanzar el error para no afectar la experiencia de usuario.\n    // El error ya est√° registrado en el servidor para depuraci√≥n.\n    return { success: false, error: 'No se pudo enviar la notificaci√≥n por WhatsApp.' };\n  }\n}\n"],"names":[],"mappings":";;;;;AAGA;;;;;AAEA,uDAAuD;AACvD,MAAM,aAAa,QAAQ,GAAG,CAAC,kBAAkB;AACjD,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;AAC/C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,oBAAoB;AAC3D,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW;AAEnC,eAAe,yBAAyB,WAAmB;IAChE,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,sBAAsB,CAAC,YAAY;QACnE,QAAQ,KAAK,CAAC;QACd,sEAAsE;QACtE,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4D;IAC9F;IAEA,MAAM,SAAS,CAAA,GAAA,sIAAA,CAAA,UAAM,AAAD,EAAE,YAAY;IAElC,IAAI;QACF,QAAQ,GAAG,CAAC,CAAC,0CAA0C,EAAE,WAAW,GAAG,CAAC;QACxE,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,MAAM,CAAC;YAC3C,MAAM;YACN,MAAM;YACN,IAAI;QACN;QACA,QAAQ,GAAG,CAAC,CAAC,gDAAgD,EAAE,QAAQ,GAAG,EAAE;QAC5E,OAAO;YAAE,SAAS;YAAM,KAAK,QAAQ,GAAG;QAAC;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8DAA8D;QAC5E,kEAAkE;QAClE,8DAA8D;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAkD;IACpF;AACF;;;IAxBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/email.ts"],"sourcesContent":["\n'use server';\n\nimport { Resend } from 'resend';\nimport { adminDb, isAdminReady } from '@/lib/firebase-admin';\n\nconst resendApiKey = process.env.RESEND_API_KEY;\nconst fromEmail = process.env.FROM_EMAIL;\n\nlet resend: Resend | null = null;\n\nif (resendApiKey && fromEmail && resendApiKey !== 'YOUR_API_KEY') {\n  resend = new Resend(resendApiKey);\n} else {\n  console.warn('‚ö†Ô∏è [Resend] API Key o correo de origen no configurado. Las notificaciones por email est√°n deshabilitadas.');\n}\n\ninterface EmailParams {\n  to: string;\n  subject: string;\n  html: string;\n}\n\nexport async function sendPermitUpdateEmail({ to, subject, html }: EmailParams) {\n  if (!resend || !fromEmail) {\n    console.log('[Email] Env√≠o de correo omitido por falta de configuraci√≥n.');\n    return { success: false, error: 'El servicio de correo no est√° configurado.' };\n  }\n\n  try {\n    const { data, error } = await resend.emails.send({\n      from: `SGTC M√≥vil <${fromEmail}>`,\n      to,\n      subject,\n      html,\n    });\n\n    if (error) {\n      throw error;\n    }\n\n    console.log(`‚úÖ [Email] Correo enviado exitosamente a ${to}. ID: ${data?.id}`);\n    return { success: true, data };\n  } catch (error) {\n    console.error(`‚ùå [Email] Fall√≥ el env√≠o de correo a ${to}:`, error);\n    return { success: false, error: 'No se pudo enviar la notificaci√≥n por correo.' };\n  }\n}\n\nexport async function getEmailForUser(userId: string): Promise<string | null> {\n  if (!isAdminReady()) return null;\n  try {\n    const userDoc = await adminDb.collection('users').doc(userId).get();\n    if (userDoc.exists) {\n      return userDoc.data()?.email || null;\n    }\n    return null;\n  } catch (error) {\n    console.error(`Error al obtener el email para el usuario ${userId}:`, error);\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;AAGA;AACA;;;;;;;;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc;AAC/C,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;AAExC,IAAI,SAAwB;AAE5B,IAAI,gBAAgB,aAAa,iBAAiB,gBAAgB;IAChE,SAAS,IAAI,wIAAA,CAAA,SAAM,CAAC;AACtB,OAAO;IACL,QAAQ,IAAI,CAAC;AACf;AAQO,eAAe,sBAAsB,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAe;IAC5E,IAAI,CAAC,UAAU,CAAC,WAAW;QACzB,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE,SAAS;YAAO,OAAO;QAA6C;IAC/E;IAEA,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YAC/C,MAAM,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;YACjC;YACA;YACA;QACF;QAEA,IAAI,OAAO;YACT,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC,CAAC,wCAAwC,EAAE,GAAG,MAAM,EAAE,MAAM,IAAI;QAC5E,OAAO;YAAE,SAAS;YAAM;QAAK;IAC/B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,qCAAqC,EAAE,GAAG,CAAC,CAAC,EAAE;QAC7D,OAAO;YAAE,SAAS;YAAO,OAAO;QAAgD;IAClF;AACF;AAEO,eAAe,gBAAgB,MAAc;IAClD,IAAI,CAAC,CAAA,GAAA,+HAAA,CAAA,eAAY,AAAD,KAAK,OAAO;IAC5B,IAAI;QACF,MAAM,UAAU,MAAM,+HAAA,CAAA,UAAO,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,GAAG;QACjE,IAAI,QAAQ,MAAM,EAAE;YAClB,OAAO,QAAQ,IAAI,IAAI,SAAS;QAClC;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,0CAA0C,EAAE,OAAO,CAAC,CAAC,EAAE;QACtE,OAAO;IACT;AACF;;;IAtCsB;IA0BA;;AA1BA,+OAAA;AA0BA,+OAAA","debugId":null}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { adminDb, isAdminReady } from '@/lib/firebase-admin';\nimport { revalidatePath } from 'next/cache';\nimport type { Permit, ExternalWorker, PermitStatus, PermitClosure, Approval, UserRole, AnexoAltura, AnexoConfinado, AnexoEnergias, AnexoExcavaciones, AnexoIzaje, AnexoATS, PermitGeneralInfo, JustificacionATS, ValidacionDiaria, User, Notification } from '@/types';\nimport { FieldValue } from 'firebase-admin/firestore';\nimport { sendWhatsAppNotification } from '@/lib/notifications';\nimport { getEmailForUser, sendPermitUpdateEmail } from '@/lib/email';\nimport { config } from 'dotenv';\nconfig();\n\n// --- Funciones Auxiliares para Notificaciones ---\n\nconst getInvolvedUsers = async (permit: Permit): Promise<string[]> => {\n  const userIds = new Set<string>();\n\n  // 1. Creador del permiso\n  if (permit.createdBy) {\n    userIds.add(permit.createdBy);\n  }\n\n  // 2. Usuarios que han firmado\n  Object.values(permit.approvals || {}).forEach(approval => {\n    if (approval && approval.userId) {\n      userIds.add(approval.userId);\n    }\n  });\n\n  // 3. Roles administrativos o de supervisi√≥n que deber√≠an ser notificados\n  const adminsQuery = await adminDb.collection('users').where('role', 'in', ['admin', 'autorizante', 'lider_sst']).get();\n  adminsQuery.forEach(doc => userIds.add(doc.id));\n\n  return Array.from(userIds);\n};\n\nconst createNotification = async (\n  userId: string,\n  permit: Permit,\n  message: string,\n  type: Notification['type'],\n  triggeredBy: { uid: string, displayName: string | null }\n) => {\n  const notification = {\n    userId,\n    permitId: permit.id,\n    permitNumber: permit.number || '',\n    message,\n    type,\n    isRead: false,\n    createdAt: FieldValue.serverTimestamp(),\n    triggeredBy,\n  };\n  await adminDb.collection('notifications').add(notification);\n  \n  // Enviar correo electr√≥nico\n  const userEmail = await getEmailForUser(userId);\n  if (userEmail) {\n    await sendPermitUpdateEmail({\n      to: userEmail,\n      subject: `Actualizaci√≥n en Permiso SGTC: ${permit.number || permit.id}`,\n      html: `<p>${message}</p><p>Puedes ver los detalles del permiso haciendo clic <a href=\"${process.env.NEXT_PUBLIC_BASE_URL}/permits/${permit.id}\">aqu√≠</a>.</p>`\n    });\n  }\n};\n\n// --- Fin de Funciones de Notificaciones ---\n\nconst workTypesMap: {[key: string]: string} = {\n  'alturas': 'Trabajo en Alturas',\n  'confinado': 'Espacios Confinados',\n  'energia': 'Control de Energ√≠as',\n  'izaje': 'Izaje de Cargas',\n  'excavacion': 'Excavaciones',\n  'general': 'Trabajo General'\n};\n\nconst getWorkTypesString = (permit: Partial<Permit>): string => {\n  const selectedTypes: string[] = [];\n  if (permit.trabajoAlturas) selectedTypes.push('Trabajo en Alturas');\n  if (permit.espaciosConfinados) selectedTypes.push('Espacios Confinados');\n  if (permit.controlEnergia) selectedTypes.push('Control de Energ√≠as');\n  if (permit.izajeCargas) selectedTypes.push('Izaje de Cargas');\n  if (permit.excavaciones) selectedTypes.push('Excavaciones');\n  \n  if (selectedTypes.length === 0) {\n    if (permit.trabajoGeneral) return 'Trabajo General';\n    // Fallback for old data structure\n    if (permit.workType && Array.isArray(permit.workType)) {\n      return permit.workType.map(key => workTypesMap[key] || key).join(', ');\n    }\n    return 'Trabajo General';\n  }\n  return selectedTypes.join(', ');\n};\n\nconst getStatusText = (status: string) => {\n    const statusText: {[key: string]: string} = {\n      'borrador': 'Borrador',\n      'pendiente_revision': 'Pendiente de Revisi√≥n',\n      'aprobado': 'Aprobado',\n      'en_ejecucion': 'En Ejecuci√≥n',\n      'suspendido': 'Suspendido',\n      'cerrado': 'Cerrado',\n      'rechazado': 'Rechazado'\n    };\n    return statusText[status] || status;\n  };\n\nconst signatureRoles: { [key in 'solicitante' | 'autorizante' | 'mantenimiento' | 'lider_sst' | 'coordinador_alturas']: string } = {\n  coordinador_alturas: 'COORDINADOR DE TRABAJOS EN ALTURAS',\n  solicitante: 'QUIEN SOLICITA (L√çDER A CARGO DEL EQUIPO EJECUTANTE)',\n  autorizante: 'QUIEN AUTORIZA (JEFES Y DUE√ëOS DE AREA)',\n  mantenimiento: 'PERSONAL DE MANTENIMIENTO',\n  lider_sst: 'AREA SST (si aplica)',\n};\n\n\ntype PermitCreateData = Omit<Permit, 'id' | 'createdAt' | 'status' | 'createdBy' | 'number' | 'user' | 'approvals' | 'closure'> & {\n  userId: string;\n  userDisplayName: string | null;\n  userEmail: string | null;\n  userPhotoURL: string | null;\n};\n\nexport async function createPermit(data: PermitCreateData) {\n  if (!data.userId) {\n    return { success: false, error: 'User not authenticated' };\n  }\n   if (!isAdminReady()) {\n    return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n  }\n\n  const { userId, userDisplayName, userEmail, userPhotoURL, ...permitData } = data;\n\n  const initialApprovals = {\n    solicitante: { status: 'pendiente' as const },\n    autorizante: { status: 'pendiente' as const },\n    mantenimiento: { status: 'pendiente' as const },\n    lider_sst: { status: 'pendiente' as const },\n    coordinador_alturas: { status: 'pendiente' as const },\n  };\n\n  const permitPayload: Partial<Permit> = {\n    ...permitData,\n    status: 'pendiente_revision' as const,\n    createdBy: userId,\n    createdAt: FieldValue.serverTimestamp(),\n    user: {\n      displayName: userDisplayName,\n      email: userEmail,\n      photoURL: userPhotoURL,\n    },\n    approvals: initialApprovals,\n    closure: {},\n  };\n  \n  try {\n    const docRef = await adminDb.collection('permits').add(permitPayload as any);\n    const permitNumber = `PT-${Date.now()}-${docRef.id.substring(0, 6).toUpperCase()}`;\n    await docRef.update({ number: permitNumber });\n    \n    console.log('‚úÖ [Action] Permiso creado con √©xito en Firestore:', docRef.id);\n\n    const createdPermit = { ...permitPayload, id: docRef.id, number: permitNumber } as Permit;\n    const involvedUsers = await getInvolvedUsers(createdPermit);\n    const message = `Se cre√≥ un nuevo permiso de trabajo: #${permitNumber}`;\n    \n    for (const uid of involvedUsers) {\n      if (uid !== userId) { // No notificar al creador sobre su propia acci√≥n\n        await createNotification(uid, createdPermit, message, 'creation', { uid: userId, displayName: userDisplayName });\n      }\n    }\n\n    const workTypesText = getWorkTypesString(permitPayload);\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n    const permitUrl = `${baseUrl}/permits/${docRef.id}`;\n    \n    const messageBody = `*¬°Alerta de Seguridad SGPT!* üö®\nSe ha creado una nueva solicitud de permiso de trabajo.\n\nüìÑ *N√∫mero:* ${permitNumber}\nüë§ *Solicitante:* ${userDisplayName || 'N/A'}\nüõ†Ô∏è *Tipo de Trabajo:* ${workTypesText}\n\nPor favor, revise la solicitud para su aprobaci√≥n en el siguiente enlace:\n${permitUrl}`;\n    \n    await sendWhatsAppNotification(messageBody);\n    \n    revalidatePath('/permits');\n    revalidatePath('/dashboard');\n    \n    return { success: true, permitId: docRef.id, permitNumber };\n  } catch (error: any) {\n    console.error(\"‚ùå [Action] Error al crear permiso:\", error);\n    return { \n      success: false, \n      error: error.message || 'Could not create permit. Please try again.' \n    };\n  }\n}\n\nexport async function savePermitDraft(data: PermitCreateData & { draftId?: string }) {\n  if (!data.userId) {\n    return { success: false, error: 'User not authenticated' };\n  }\n  if (!isAdminReady()) {\n    return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n  }\n\n  const { userId, userDisplayName, userEmail, userPhotoURL, draftId, ...permitData } = data;\n\n  const initialApprovals = {\n    solicitante: { status: 'pendiente' as const },\n    autorizante: { status: 'pendiente' as const },\n    mantenimiento: { status: 'pendiente' as const },\n    lider_sst: { status: 'pendiente' as const },\n    coordinador_alturas: { status: 'pendiente' as const },\n  };\n\n  const permitPayload: Partial<Permit> = {\n    ...permitData,\n    status: 'borrador' as const,\n    createdBy: userId,\n    user: {\n      displayName: userDisplayName,\n      email: userEmail,\n      photoURL: userPhotoURL,\n    },\n    approvals: initialApprovals,\n  };\n\n  try {\n    if (draftId) {\n      // Actualizar un borrador existente\n      const docRef = adminDb.collection('permits').doc(draftId);\n      await docRef.update({ ...permitPayload, updatedAt: FieldValue.serverTimestamp() });\n      revalidatePath(`/permits/${draftId}`);\n      revalidatePath('/permits');\n      return { success: true, permitId: draftId, isUpdate: true };\n    } else {\n      // Crear un nuevo borrador\n      permitPayload.createdAt = FieldValue.serverTimestamp();\n      const docRef = await adminDb.collection('permits').add(permitPayload as any);\n      revalidatePath('/permits');\n      return { success: true, permitId: docRef.id, isUpdate: false };\n    }\n  } catch (error: any) {\n    console.error(\"‚ùå [Action] Error al guardar borrador:\", error);\n    return { \n      success: false, \n      error: error.message || 'Could not save draft. Please try again.' \n    };\n  }\n}\n\n\nexport async function addSignatureAndNotify(\n  permitId: string, \n  role: 'solicitante' | 'autorizante' | 'mantenimiento' | 'lider_sst' | 'coordinador_alturas' | 'cierre_autoridad' | 'cierre_responsable' | 'cancelacion', \n  signatureType: 'firmaApertura' | 'firmaCierre',\n  signatureDataUrl: string,\n  user: User,\n  comments?: string,\n  permitData?: Permit,\n) {\n    if (!permitId || !role || !signatureDataUrl || !user) {\n        return { success: false, error: 'Faltan par√°metros para guardar la firma.' };\n    }\n    if (!isAdminReady()) {\n      return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n    }\n\n    try {\n        const docRef = adminDb.collection('permits').doc(permitId);\n        \n        let updateData: { [key: string]: any } = {};\n\n        // L√≥gica para manejar firmas de aprobaci√≥n y de cierre/cancelaci√≥n\n        if (role.startsWith('cierre_') || role === 'cancelacion') {\n            const closureRole = role === 'cierre_autoridad' ? 'autoridad' : (role === 'cierre_responsable' ? 'responsable' : 'canceladoPor');\n            const closurePath = `closure.${closureRole}`;\n            \n            const existingClosureData = (await docRef.get()).data()?.closure?.[closureRole] || {};\n\n            updateData[closurePath] = {\n                ...existingClosureData,\n                firma: signatureDataUrl,\n                nombre: user.displayName,\n                fecha: FieldValue.serverTimestamp() \n            };\n\n        } else {\n            const approvalData: Partial<Approval> = {\n                status: 'aprobado',\n                firmaApertura: signatureDataUrl,\n                userName: user.displayName,\n                userId: user.uid,\n                signedAt: FieldValue.serverTimestamp() as any,\n                userRole: user.role,\n                userEmpresa: user.empresa || 'N/A',\n                comments: comments || '',\n            }\n            \n            updateData[`approvals.${role}`] = approvalData;\n            \n            const permitDocBefore = await docRef.get();\n            const permitBeforeData = permitDocBefore.data() as Permit | undefined;\n            \n            if (signatureType === 'firmaApertura') {\n                const validationPayload: ValidacionDiaria = { dia: 1, nombre: user.displayName || '', firma: signatureDataUrl, fecha: new Date().toISOString() };\n                \n                if (role === 'solicitante') {\n                    if (permitBeforeData && permitBeforeData.status === 'borrador') {\n                        const permitNumber = `PT-${Date.now()}-${permitId.substring(0, 6).toUpperCase()}`;\n                        updateData['number'] = permitNumber;\n                        updateData['status'] = 'pendiente_revision';\n                        updateData['isSSTSignatureRequired'] = permitData?.anexoAltura?.tareaRealizar?.id === 'otro';\n                    }\n\n                    // Auto-llenar validaci√≥n diaria del responsable\n                    ['anexoAltura', 'anexoConfinado', 'anexoIzaje', 'anexoExcavaciones'].forEach(anexo => {\n                        if ((permitBeforeData as any)?.[anexo]) {\n                            const currentValidations = (permitBeforeData as any)[anexo].validacion?.responsable || [];\n                            currentValidations[0] = validationPayload;\n                            updateData[`${anexo}.validacion.responsable`] = currentValidations;\n                        }\n                    });\n\n                } else if (role === 'autorizante') {\n                    // Auto-llenar validaci√≥n diaria de la autoridad\n                     ['anexoAltura', 'anexoConfinado', 'anexoIzaje', 'anexoExcavaciones'].forEach(anexo => {\n                        if ((permitBeforeData as any)?.[anexo]) {\n                            const currentValidations = (permitBeforeData as any)[anexo].validacion?.autoridad || [];\n                            currentValidations[0] = validationPayload;\n                            updateData[`${anexo}.validacion.autoridad`] = currentValidations;\n                        }\n                    });\n                }\n            }\n\n            // *** NUEVA L√ìGICA DE APROBACI√ìN AUTOM√ÅTICA ***\n            const updatedApprovals = { ...permitBeforeData?.approvals, [role]: approvalData };\n            const isSSTRequired = permitBeforeData?.isSSTSignatureRequired;\n\n            let allRequiredSignaturesDone = \n                updatedApprovals.solicitante?.status === 'aprobado' &&\n                updatedApprovals.autorizante?.status === 'aprobado';\n            \n            if (permitBeforeData?.controlEnergia) {\n                allRequiredSignaturesDone = allRequiredSignaturesDone && updatedApprovals.mantenimiento?.status === 'aprobado';\n            }\n            if (isSSTRequired) {\n                allRequiredSignaturesDone = allRequiredSignaturesDone && updatedApprovals.lider_sst?.status === 'aprobado';\n            }\n            \n            // Si se cumplen las condiciones, se pone en ejecuci√≥n.\n            if (allRequiredSignaturesDone) {\n                updateData['status'] = 'en_ejecucion';\n            }\n        }\n        \n        await docRef.update(updateData);\n        \n        const permitDoc = await docRef.get();\n        const updatedPermitData = { id: permitDoc.id, ...permitDoc.data() } as Permit;\n        \n        const signatureRoleName = (signatureRoles as any)[role] || role.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n        \n        const message = `${user.displayName || 'Un usuario'} ha firmado el permiso #${updatedPermitData.number} como ${signatureRoleName}.`;\n        const involvedUsers = await getInvolvedUsers(updatedPermitData);\n        \n        for (const uid of involvedUsers) {\n          if (uid !== user.uid) { // No notificar al usuario sobre su propia acci√≥n\n            await createNotification(uid, updatedPermitData, message, 'signature', user);\n          }\n        }\n        \n        // Notificaci√≥n adicional si el permiso se puso en ejecuci√≥n\n        if (updateData['status'] === 'en_ejecucion') {\n            const executionMessage = `El permiso #${updatedPermitData.number} ha sido aprobado y se encuentra ahora EN EJECUCI√ìN.`;\n            for (const uid of involvedUsers) {\n                 if (uid !== user.uid) {\n                    await createNotification(uid, updatedPermitData, executionMessage, 'approval', user);\n                }\n            }\n        }\n\n        revalidatePath(`/permits/${permitId}`);\n        return { success: true };\n\n    } catch (error: any) {\n        console.error(\"‚ùå Error al guardar firma y notificar:\", error);\n        return {\n            success: false,\n            error: error.message || 'No se pudo guardar la firma.'\n        };\n    }\n}\n\n\nexport async function updatePermitStatus(\n  permitId: string,\n  status: PermitStatus,\n  currentUser: { uid: string, displayName: string | null },\n  reason?: string,\n  closureData?: Partial<PermitClosure>\n) {\n    if (!permitId) {\n        return { success: false, error: 'Permit ID is required.' };\n    }\n    if (!isAdminReady()) {\n      return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n    }\n\n    try {\n        const docRef = adminDb.collection('permits').doc(permitId);\n        const updateData: { status: PermitStatus; rejectionReason?: string; closure?: Partial<PermitClosure> | FieldValue } = { status };\n\n        if (status === 'rechazado' && reason) {\n            updateData.rejectionReason = reason;\n        }\n\n        if (status === 'cerrado') {\n            updateData.closure = {\n                ...(closureData || {}),\n                fechaCierre: FieldValue.serverTimestamp(),\n            };\n        }\n\n        await docRef.update(updateData);\n\n        const permitDoc = await docRef.get();\n        const permitData = { id: permitDoc.id, ...permitDoc.data() } as Permit;\n        \n        const triggeredBy = currentUser;\n        \n        let notificationType: Notification['type'] = 'status_change';\n        let message = `${currentUser.displayName || 'Un usuario'} ha cambiado el estado del permiso #${permitData.number} a: ${getStatusText(status)}.`;\n\n        if (status === 'aprobado') {\n            notificationType = 'approval';\n            message = `${currentUser.displayName || 'Un usuario'} ha aprobado el permiso #${permitData.number}.`;\n        } else if (status === 'rechazado') {\n            notificationType = 'rejection';\n            message = `${currentUser.displayName || 'Un usuario'} ha rechazado el permiso #${permitData.number}.`;\n            if (reason) {\n                message += ` Motivo: ${reason}`;\n            }\n        } else if (status === 'cerrado') {\n            notificationType = 'cancellation'; // Using cancellation for close\n            message = `${currentUser.displayName || 'Un usuario'} ha cerrado el permiso #${permitData.number}.`;\n        }\n        \n        const involvedUsers = await getInvolvedUsers(permitData);\n\n        for (const uid of involvedUsers) {\n             if (uid !== currentUser.uid) { // No notificar al usuario sobre su propia acci√≥n\n                await createNotification(uid, permitData, message, notificationType, triggeredBy);\n            }\n        }\n\n        const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n        const permitUrl = `${baseUrl}/permits/${permitId}`;\n\n        let messageBody = `*Actualizaci√≥n de Estado - SGPT* üîÑ\nEl estado del permiso *${permitData.number || permitId}* ha cambiado.\n\n*Nuevo Estado:* ${getStatusText(status)}\n\nPuede ver los detalles aqu√≠:\n${permitUrl}`;\n\n        if (status === 'rechazado' && reason) {\n          messageBody += `\\n\\n*Motivo del rechazo:* ${reason}`;\n        }\n        \n        await sendWhatsAppNotification(messageBody);\n        \n        revalidatePath(`/permits/${permitId}`);\n        revalidatePath('/permits');\n        revalidatePath('/dashboard');\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"‚ùå Error updating permit status:\", error);\n        return {\n            success: false,\n            error: error.message || 'Could not update permit status.'\n        };\n    }\n}\n\nexport async function addDailyValidationSignature(permitId: string, anexoName: string, validationType: 'autoridad' | 'responsable', index: number, data: ValidacionDiaria, user: User) {\n  if (!permitId || !anexoName || !validationType || index < 0 || !data || !user) {\n    return { success: false, error: 'Par√°metros inv√°lidos.' };\n  }\n\n  if (!isAdminReady()) {\n    return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n  }\n\n  const docRef = adminDb.collection('permits').doc(permitId);\n  try {\n    const permitSnap = await docRef.get();\n    if (!permitSnap.exists) {\n      return { success: false, error: 'El permiso no existe.' };\n    }\n    const permitData = permitSnap.data() as Permit;\n\n    const anexoData = (permitData as any)[anexoName];\n    if (!anexoData || !anexoData.validacion) {\n      return { success: false, error: `El anexo ${anexoName} o su estructura de validaci√≥n no existen en el permiso.` };\n    }\n    \n    const validationArray = (anexoData.validacion[validationType] as ValidacionDiaria[]) || [];\n    \n    while (validationArray.length <= index) {\n        validationArray.push({ dia: validationArray.length + 1, nombre: '', fecha: '', firma: '' });\n    }\n\n    validationArray[index] = data;\n    \n    const updatePath = `${anexoName}.validacion.${validationType}`;\n    \n    await docRef.update({\n      [updatePath]: validationArray,\n    });\n\n    // --- L√≥gica de Notificaci√≥n ---\n    const fullPermitData = { id: docRef.id, ...permitData } as Permit;\n    const anexoDisplayName = anexoName.replace('anexo', 'Anexo ');\n    const validationRoleName = validationType === 'autoridad' ? 'Autoridad del √Årea' : 'Responsable del Trabajo';\n    const day = index + 1;\n\n    // Notificaciones en la App y por Email\n    const message = `${user.displayName || 'Un usuario'} ha realizado la validaci√≥n diaria (${validationRoleName}) para el D√çA ${day} del ${anexoDisplayName} en el permiso #${fullPermitData.number}.`;\n    const involvedUsers = await getInvolvedUsers(fullPermitData);\n    for (const uid of involvedUsers) {\n      if (uid !== user.uid) {\n        await createNotification(uid, fullPermitData, message, 'status_change', user);\n      }\n    }\n\n    // Notificaci√≥n por WhatsApp\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://sgpt-movil.web.app';\n    const permitUrl = `${baseUrl}/permits/${permitId}`;\n    const whatsappMessage = `*Validaci√≥n Diaria - SGPT* ‚úçÔ∏è\nSe ha registrado una nueva firma de validaci√≥n diaria.\n\nüìÑ *Permiso:* ${fullPermitData.number || 'N/A'}\nüóìÔ∏è *D√≠a:* ${day}\nüë§ *Firmante:* ${user.displayName || 'N/A'}\n‚úÖ *Rol:* ${validationRoleName}\nüìã *Anexo:* ${anexoDisplayName}\n\nPuede ver los detalles aqu√≠:\n${permitUrl}`;\n    \n    await sendWhatsAppNotification(whatsappMessage);\n\n\n    revalidatePath(`/permits/${permitId}`);\n    return { success: true };\n\n  } catch (error: any) {\n    console.error(\"‚ùå Error al guardar la validaci√≥n diaria:\", error);\n    return { success: false, error: 'No se pudo guardar la firma de validaci√≥n.' };\n  }\n}\n\nexport async function addWorkerSignature(permitId: string, workerIndex: number, signatureType: 'firmaApertura' | 'firmaCierre', signatureDataUrl: string) {\n    if (!permitId || workerIndex < 0 || !signatureType || !signatureDataUrl) {\n        return { success: false, error: 'Faltan par√°metros.' };\n    }\n    if (!isAdminReady()) {\n      return { success: false, error: 'Credenciales de administrador de Firebase no configuradas en el servidor.' };\n    }\n\n    const docRef = adminDb.collection('permits').doc(permitId);\n    try {\n        const permitSnap = await docRef.get();\n        if (!permitSnap.exists) {\n            return { success: false, error: 'El permiso no existe.' };\n        }\n\n        const permitData = permitSnap.data() as Permit;\n        const workers = permitData.workers ? [...permitData.workers] : [];\n\n        if (workerIndex >= workers.length) {\n            return { success: false, error: '√çndice de trabajador inv√°lido.' };\n        }\n\n        const signatureField = signatureType === 'firmaApertura' ? 'firmaApertura' : 'firmaCierre';\n        const dateField = signatureType === 'firmaApertura' ? 'fechaFirmaApertura' : 'fechaFirmaCierre';\n\n        workers[workerIndex] = {\n            ...workers[workerIndex],\n            [signatureField]: signatureDataUrl,\n            [dateField]: new Date().toISOString(), \n        };\n\n        await docRef.update({ workers: workers });\n\n        revalidatePath(`/permits/${permitId}`);\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Error al guardar la firma del trabajador:\", error);\n        return { success: false, error: 'No se pudo guardar la firma.' };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1031, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/permits/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {updatePermitStatus as '7c73b9c7850e737568a6f6f7a4e17cda15a8f18e15'} from 'ACTIONS_MODULE0'\nexport {addSignatureAndNotify as '7f15bdb6ac388e78a59299d5091891127d63de7bc6'} from 'ACTIONS_MODULE0'\nexport {addDailyValidationSignature as '7edc6233c637b331b2fa6dba912da67e147424b389'} from 'ACTIONS_MODULE0'\nexport {addWorkerSignature as '78ef86f0b5ad2d150f478f7151b2ac622c1a91d8a4'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 1121, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/%5Bid%5D/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/[id]/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/[id]/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuS,GACpU,qEACA","debugId":null}},
    {"offset": {"line": 1135, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/permits/%5Bid%5D/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/permits/[id]/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/permits/[id]/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAmR,GAChT,iDACA","debugId":null}},
    {"offset": {"line": 1149, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}